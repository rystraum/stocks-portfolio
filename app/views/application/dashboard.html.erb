<ul class="top-menu">
    <li><%= link_to "Price Update", new_price_update_path %></li>
    <li><%= link_to "New Transaction", new_activity_path %></li>
    <li><%= link_to "Cash Dividends", cash_dividends_path %></li>
    <li><%= link_to "Stock Dividends", stock_dividends_path %></li>
    <li><%= link_to "Companies", companies_path %></li>
    <li><%= link_to "Activity History", activities_path %></li>
    <li><%= link_to "Price History", price_updates_path %></li>
</ul>
<h1>Portfolio (All Time)</h1>
<table>
    <thead>
        <tr>
            <th>Company</th>
            <th>Shares</th>
            <th class="r-align">Total Cost</th>
            <th class="r-align">CPS</th>
            <th class="r-align">% cost</th>
            <th class="r-align">Last Price</th>
            <th class="r-align">Last Value</th>
            <th class="r-align">% Value</th>
            <th colspan="2">P/L</th>
            <th colspan="2">Divs</th>
            <th colspan="2">Annual DPS</th>
            <th colspan="2">P/L + Divs</th>
        </tr>
    </thead>
    <tbody>
        <% cs = CompanySet.new(Company.all) %>
        <% cs.companies.each do |company| %>
            <tr class="<%= company.inactive? ? "inactive" : "active" %>"">
                <td><%= link_to company, company %><%= "*" if company.inactive? %></td>
                <td><%= company.total_shares %></td>
                <td class="r-align"><%= format_currency company.total_costs %></td>
                <td class="r-align"><%= format_currency company.cps %></td>
                <td class="r-align"><%= format_percentage company.total_costs, cs.total_costs %></td>
                <td class="r-align">
                    <%= format_currency company.last_price %><br>
                    <small><%= company.last_price_timestamp.to_formatted_s(:short) %></small>
                </td>
                <td class="r-align"><%= format_currency company.last_value %></td>
                <td class="r-align"><%= format_percentage company.last_value, cs.total_value %></td>
                <td class="r-align"><%= green_red company.profit_loss %></td>
                <td class="r-align"><%= green_red_percent company.profit_loss, company.actual_total_costs %></td>
                <td class="r-align"><%= format_currency company.cash_dividends_total %></td>
                <td class="r-align"><%= format_percentage company.cash_dividends_total, company.total_costs %></td>
                <td class="r-align">
                    <% begin %>
                        <%= format_currency company.cash_dividends_annual_dps %>
                        <% rescue ZeroDivisionError %>
                        <%= link_to "Recompute", company %>
                    <% end %>
                </td>
                <td class="r-align">
                    <% begin %>
                        <%= format_percentage company.cash_dividends_annual_dps, company.cps %>
                        <% rescue ZeroDivisionError %>
                        <%= link_to "Recompute", company %>
                    <% end %></td>
                <td class="r-align"><%= green_red company.final_profit_loss %></td>
                <td class="r-align"><%= green_red_percent company.final_profit_loss, company.total_costs %></td>
            </tr>
        <% end %>
    </tbody>
    <tfoot>
        <tr>
            <td>Totals</td>
            <td>-</td>
            <td class="r-align"><%= format_currency cs.total_costs %></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td class="r-align"><%= format_currency cs.total_value %></td>
            <td>-</td>
            <td class="r-align"><%= green_red cs.total_profit_loss %></td>
            <td class="r-align"><%= green_red_percent cs.total_profit_loss, cs.total_value %></td>
            <td class="r-align"><%= format_currency cs.total_dividends %></td>
            <td class="r-align"><%= format_percentage cs.total_dividends, cs.total_costs %></td>
            <td>-</td>
            <td>-</td>
            <td class="r-align"><%= green_red cs.final_profit_loss %></td>
            <td class="r-align"><%= green_red_percent cs.final_profit_loss, cs.total_value %></td>
        </tr>
        <tr style="background: none;">
            <td colspan=8>* inactive</td>
            <td colspan=8>P/L Total also includes P/L from 0 share stocks</td>
        </tr>
    </tfoot>
</table>
